"use strict";function ownKeys(e,t){var n,l=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),l.push.apply(l,n)),l}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}window.mathquill4quill=function(t){var j=(t=t||{}).Quill||window.Quill,E=t.MathQuill||window.MathQuill,_=t.katex||window.katex,C=t.localStorage||window.localStorage;function x(t){try{return C.getItem(t)}catch(t){return""}}return function(n,t){function o(){return n.container.getElementsByClassName("ql-tooltip")[0]}function l(){return o().getElementsByTagName("input")[0]}var e,r,i,u,a,c,s,d,f,m,p,h,b,y,g,w,v,q;function O(e,t){var n=null==f.handlers?{}:f.handlers;f.handlers=_objectSpread(_objectSpread({},n),{},{edit:function(){var t=l.latex();e.value=t,function(t,e){try{C.setItem(t,e)}catch(t){}}(m,t)},enter:function(){t.click()}});var l=E.getInterface(2).MathField(p,f),n=x(m);return n&&l.latex(n),t.addEventListener("click",function(){!function(t){var e=x(t);if(e&&0<e.length){t=i.indexOf(e);-1!=t&&i.splice(t,1),i.unshift(e),i.length>u&&i.pop();try{C.setItem(r,JSON.stringify(i))}catch(t){}}}(m),function(t){try{C.removeItem(t)}catch(t){}}(m)}),l}t=t||{},function(){if(j)if(E)if(_)if(n.options.modules.formula){if(MutationObserver)return 1;console.log("MutationObserver not defined")}else console.log("Formula module not enabled");else console.log("katex.js not loaded");else console.log("MathQuill.js not loaded");else console.log("Quill.js not loaded")}()&&(e=o(),r=t.historyCacheKey||"__mathquill4quill_historylist_cache__",i=function(t){try{return JSON.parse(C.getItem(t))||[]}catch(t){return[]}}(r),u=t.historySize||10,a=t.displayHistory||!1,d=null==t.autofocus||t.autofocus,f=null!=t.mathQuillConfig?t.mathQuillConfig:{},m=t.cacheKey||"__mathquill4quill_cache__",h=p=null,c={render:function(){if(null==p){var t,e=l(),n=o().getElementsByClassName("ql-action")[0];return(p=document.createElement("span")).setAttribute("class","mathquill4quill-mathquill-input"),h=e.className,e.setAttribute("class","mathquill4quill-latex-input"),s=O(e,n),t=s,d&&window.setTimeout(function(){return t.focus()},1),n=p,(e=e).parentNode.insertBefore(n,e.nextSibling),s}},destroy:function(){null!=p&&(l().setAttribute("class",h),p.remove(),p=null)}},y=t.operators||[],b={render:function(r){var t;null==g&&0!==y.length&&(t=o(),(g=document.createElement("div")).setAttribute("class","mathquill4quill-operator-container"),y.forEach(function(t){var e,n,l,e=(n=r,t=(e=t)[0],l=e[1],(e=document.createElement("button")).setAttribute("type","button"),_.render(t,e,{throwOnError:!1}),e.onclick=function(){n.cmd(l),n.focus()},e);e.setAttribute("class","mathquill4quill-operator-button"),g.appendChild(e)}),t.appendChild(g))},destroy:function(){null!=g&&(g.remove(),g=null)}},v=i||[],q=g=null,w={render:function(l){var t,r,e;(e=o()).getBoundingClientRect().top-n.container.getBoundingClientRect().top<0&&(e.style.top="0px"),null==q&&a&&0!==v.length&&(t=o(),q=document.createElement("div"),(r=document.createElement("div")).setAttribute("class","mathquill4quill-history-container"),(e=document.createElement("p")).innerHTML="Past formulas (max "+u+")",q.appendChild(e),v.forEach(function(t){var e,n,t=(e=t,n=l,(t=document.createElement("button")).setAttribute("type","button"),_.render(e,t,{throwOnError:!1}),t.onclick=function(){n.write(e),n.focus()},t);t.setAttribute("class","mathquill4quill-history-button"),r.appendChild(t)}),q.appendChild(r),t.appendChild(q))},destroy:function(){null!=q&&(q.remove(),q=null)}},new MutationObserver(function(){var t;!e.classList.contains("ql-hidden")&&e.attributes["data-mode"]&&"formula"===e.attributes["data-mode"].value?(t=c.render(),b.render(t),w.render(t)):(c.destroy(),b.destroy(),w.destroy())}).observe(e,{attributes:!0,attributeFilter:["class","data-mode"]}))}},"undefined"!=typeof module&&module.exports&&(module.exports=window.mathquill4quill),window.Quill&&(window.Quill.prototype.enableMathQuillFormulaAuthoring=function(t){window.mathquill4quill()(this,t)});
